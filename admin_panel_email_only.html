<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Crunchyroll Premium BD Shop</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <style>
    body {margin:0;font-family:'Segoe UI',sans-serif;background:#131c2b;color:white;}
    .page {display:none;padding:20px;max-width:600px;margin:auto;}
    .active {display:block;}
    img.banner {width:100%;border-radius:8px;}
    img.avatar {width:100px;height:100px;border-radius:50%;border:3px solid white;display:block;margin:20px auto;}
    input, select, button {width:100%;padding:10px;margin:8px 0;border-radius:6px;border:none;font-size:16px;}
    button {cursor:pointer;}
    .mega-btn {background:green;color:white;}
    .package-btn {background:#0f7dc8;color:white;margin-top:6px;border-radius:8px;}
    .package-btn:hover {background:#095e9f;}
    .action-btns {display:flex;justify-content:space-between;margin-top:16px;}
    .orange {background:orange;color:black;}
    .green {background:green;color:white;}
    .error {color:#ff4d4d;}
    .copy-box {background:#2d3a4a;padding:10px;border-radius:8px;margin-top:10px;}
    .top-bar {text-align:right; padding:10px 20px; background:#1c2a3a; font-weight:bold;}
  </style>
</head>
<body>

<div class="top-bar" id="userWelcome"></div>

<!-- Sign Up -->
<div id="signupPage" class="page active">
  <h2>üîê ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™</h2>
  <input id="suName" type="text" placeholder="üë§ Full Name">
  <input id="suEmail" type="email" placeholder="üìß ‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
  <input id="suPhone" type="text" placeholder="üì± ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
  <input id="suPass" type="password" placeholder="üîë ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° (‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞)">
  <input id="suConfirm" type="password" placeholder="üîë ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
  <button onclick="handleSignup()">‚úÖ ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™</button>
  <p>‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá? <a href="#" onclick="showPage('loginPage')">‡¶∏‡¶æ‡¶á‡¶® ‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
  <p id="suError" class="error"></p>
</div>

<!-- Sign In -->
<div id="loginPage" class="page">
  <h2>üîì ‡¶∏‡¶æ‡¶á‡¶® ‡¶á‡¶®</h2>
  <input id="liEmail" type="email" placeholder="üìß ‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
  <input id="liPass" type="password" placeholder="üîë ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
  <button onclick="handleLogin()">‚û°Ô∏è ‡¶∏‡¶æ‡¶á‡¶® ‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
  <p>‡¶®‡¶§‡ßÅ‡¶®? <a href="#" onclick="showPage('signupPage')">‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
  <p id="liError" class="error"></p>
</div>

<!-- Just a placeholder for remaining pages -->
<div class="page" id="mainPage"><h2>Remaining content...</h2></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDDvKtm-Mu_12pDLo_9bPvLOusx6YyoYI4",
  authDomain: "crunchyrollpremiumbd-shop.firebaseapp.com",
  projectId: "crunchyrollpremiumbd-shop",
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function validPhone(p){ return /^\d{11}$/.test(p) }
function validPass(p){ return /^\d{6}$/.test(p) }

async function handleSignup(){
  const name = document.getElementById('suName').value.trim();
  const email = document.getElementById('suEmail').value.trim();
  const phone = document.getElementById('suPhone').value.trim();
  const pw = document.getElementById('suPass').value;
  const cp = document.getElementById('suConfirm').value;
  const err = document.getElementById('suError'); err.textContent="";

  if (!validPhone(phone)){err.textContent="‚ö†Ô∏è ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡ßß‡ßß ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá"; return;}
  if (!validPass(pw)){err.textContent="‚ö†Ô∏è ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá"; return;}
  if (pw!==cp){err.textContent="‚ö†Ô∏è ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ";return;}
  if (!name){err.textContent="‚ö†Ô∏è ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®";return;}
  try {
    const snap1 = await db.collection('users').where('email','==',email).get();
    if (!snap1.empty){err.textContent="‚ö†Ô∏è ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá";return;}
    await auth.createUserWithEmailAndPassword(email, pw);
    await auth.currentUser.sendEmailVerification();
    await db.collection('users').add({name,email,phone,timestamp:firebase.firestore.FieldValue.serverTimestamp()});
    alert("‚úÖ ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶∏‡¶´‡¶≤! ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
    showPage('loginPage');
  } catch(err){err.textContent = err.message;}
}

async function handleLogin(){
  const email = document.getElementById('liEmail').value.trim();
  const pw = document.getElementById('liPass').value;
  const err = document.getElementById('liError'); err.textContent="";
  try{
    const res = await auth.signInWithEmailAndPassword(email, pw);
    if (!res.user.emailVerified){
      err.textContent="‚ö†Ô∏è ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®";
      return;
    }
    const userSnap = await db.collection("users").where("email","==",email).get();
    const userName = userSnap.docs[0]?.data()?.name || "User";
    document.getElementById("userWelcome").textContent = "üëã ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, " + userName;
    showPage('mainPage');
  } catch(err){
    err.textContent = "‚ö†Ô∏è ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤ ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶π‡ßü‡¶®‡¶ø";
  }
}
</script>
</body>
</html>
