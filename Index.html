<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crunchyroll Premium BD Shop</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <style>
    body { margin:0; font-family:'Segoe UI', sans-serif; background:#0f172a; color:#fff; }
    .page { display:none; padding:20px; max-width:600px; margin:auto; }
    .active { display:block; }
    input, select, button { width:100%; padding:10px; margin:8px 0; border-radius:6px; font-size:16px; border:none; }
    button { background:#1d4ed8; color:white; cursor:pointer; }
    h2 { text-align:center; }
    .error { color:#f87171; text-align:center; }
    .success { color:#4ade80; text-align:center; }
    .btn-orange { background:orange; color:black; }
    .btn-green { background:green; }
    .package-btn { background:#2563eb; border-radius:8px; margin-top:6px; color:#fff; }
    .package-btn:hover { background:#1e40af; }
  </style>
</head>
<body>

<!-- üîê Sign Up -->
<div id="signupPage" class="page active">
  <h2>üîê ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™</h2>
  <input id="suEmail" type="email" placeholder="üìß ‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
  <input id="suPhone" type="text" placeholder="üì± ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
  <input id="suPass" type="password" placeholder="üîë ‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
  <input id="suConfirm" type="password" placeholder="üîë ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ">
  <input id="suCity" type="text" placeholder="üèôÔ∏è ‡¶∂‡¶π‡¶∞">
  <button onclick="handleSignup()">‚úÖ ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™</button>
  <p>‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá? <a href="#" onclick="showPage('loginPage')">‡¶∏‡¶æ‡¶á‡¶® ‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
  <p id="suError" class="error"></p>
</div>

<!-- üîì Sign In -->
<div id="loginPage" class="page">
  <h2>üîì ‡¶∏‡¶æ‡¶á‡¶® ‡¶á‡¶®</h2>
  <input id="liEmail" type="email" placeholder="üìß ‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
  <input id="liPass" type="password" placeholder="üîë ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
  <button onclick="handleLogin()">‚û°Ô∏è ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
  <p>‡¶®‡¶§‡ßÅ‡¶®? <a href="#" onclick="showPage('signupPage')">‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
  <p id="liError" class="error"></p>
</div>

<!-- üè† Home Page -->
<div id="mainPage" class="page">
  <img src="https://i.postimg.cc/KvBrVgmR/20250625-061716.jpg" style="width:100%; border-radius:8px;">
  <img src="https://i.postimg.cc/PxJQF3qj/89fcdebedfdcf2bf3a00a49d75833c3a-1.jpg" style="width:100px; height:100px; border-radius:50%; margin:20px auto; display:block;">
  <h2>Crunchyroll Premium BD Shop</h2>
  <button onclick="showPage('packagePage')">üí• MEGA PACKAGES</button>
  <p style="text-align:center; margin-top:20px;">
    Total Users: <span id="userCount">0</span> |
    Total Orders: <span id="orderCount">0</span>
  </p>
</div>

<!-- üì¶ Package Page -->
<div id="packagePage" class="page">
  <h2>üì¶ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡¶∂‡¶®</h2>
  <button class="package-btn" onclick="selectPackage('Shared','1 Month',100)">Shared - 1 Month - 100TK</button>
  <button class="package-btn" onclick="selectPackage('Personal','1 Month',240)">Personal - 1 Month - 240TK</button>
  <button class="package-btn" onclick="selectPackage('Primary','1 Month',650)">Primary - 1 Month - 650TK</button>
  <button class="btn-orange" onclick="goToCheckout()">üõí Add To Cart</button>
  <button onclick="showPage('mainPage')">‚¨ÖÔ∏è Back</button>
  <p id="pkgError" class="error"></p>
</div>

<!-- ‚úÖ Checkout Page -->
<div id="checkoutPage" class="page">
  <h2>‚úÖ Checkout</h2>
  <div id="selectedInfo"></div>
  <input id="coName" type="text" placeholder="üë§ Full Name">
  <input id="coEmail" type="email" placeholder="üìß Email">
  <input id="coAddress" type="text" placeholder="üè† Address">
  <input id="coMobile" type="text" placeholder="üì± Mobile Number">
  <input id="coTransID" type="text" placeholder="üí≥ Transaction ID">
  <select id="paymentMethod" onchange="updatePaymentNumber()">
    <option value="">-- ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° --</option>
    <option value="Bkash">Bkash</option>
    <option value="Nagad">Nagad</option>
    <option value="Rocket">Rocket</option>
  </select>
  <div id="payNumber" style="margin-top:10px;"></div>
  <button class="btn-green" onclick="confirmOrder()">üì® Order Confirm</button>
  <button onclick="showPage('packagePage')">‚¨ÖÔ∏è Back</button>
  <p id="coError" class="error"></p>
</div>

<!-- üîê Firebase & EmailJS Config -->
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDDvKtm-Mu_12pDLo_9bPvLOusx6YyoYI4",
  authDomain: "crunchyrollpremiumbd-shop.firebaseapp.com",
  projectId: "crunchyrollpremiumbd-shop",
  storageBucket: "crunchyrollpremiumbd-shop.appspot.com",
  messagingSenderId: "790961397898",
  appId: "1:790961397898:web:1c5fceb8b5d3340c3bcd73",
  measurementId: "G-PSSPTLC6MJ"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

emailjs.init("SsUmUorUm-BZG8LBY");
const emailService = "service_z1714kq";
const adminTpl = "template_hp66tqp";
const custTpl = "template_1z1lhlf";
</script>

<!-- üåê Logic -->
<script>
let selectedPkg = null;

function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function validPhone(p) { return /^\d{11}$/.test(p) }
function validPass(p) { return /^\d{6}$/.test(p) }

async function handleSignup() {
  const e = suEmail.value.trim();
  const p = suPhone.value.trim();
  const pw = suPass.value;
  const cp = suConfirm.value;
  const c = suCity.value.trim();
  suError.textContent = "";
  if (!validPhone(p)) return suError.textContent = "‚ö†Ô∏è ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡ßß‡ßß ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá";
  if (!validPass(pw)) return suError.textContent = "‚ö†Ô∏è ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá";
  if (pw !== cp) return suError.textContent = "‚ö†Ô∏è ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ";
  if (!c) return suError.textContent = "‚ö†Ô∏è ‡¶∂‡¶π‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®";

  try {
    const snap1 = await db.collection('users').where('email','==',e).get();
    if (!snap1.empty) return suError.textContent = "‚ö†Ô∏è ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá";
    const snap2 = await db.collection('users').where('phone','==',p).get();
    if (!snap2.empty) return suError.textContent = "‚ö†Ô∏è ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶Ü‡¶ó‡ßá‡¶á ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡ßÉ‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá";

    await auth.createUserWithEmailAndPassword(e, pw);
    await auth.currentUser.sendEmailVerification();
    await db.collection('users').add({email:e,phone:p,city:c,timestamp:firebase.firestore.FieldValue.serverTimestamp()});
    alert("‚úÖ ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶∏‡¶´‡¶≤! ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
    showPage('loginPage');
  } catch (err) {
    suError.textContent = err.message;
  }
}

async function handleLogin() {
  const e = liEmail.value.trim();
  const pw = liPass.value;
  liError.textContent = "";
  try {
    const res = await auth.signInWithEmailAndPassword(e, pw);
    if (!res.user.emailVerified) return liError.textContent = "‚ö†Ô∏è ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®";
    showPage('mainPage');
    db.collection('users').onSnapshot(s => userCount.textContent = s.size);
    db.collection('orders').onSnapshot(s => orderCount.textContent = s.size);
  } catch (err) {
    liError.textContent = err.message;
  }
}

function selectPackage(type, duration, price) {
  selectedPkg = { type, duration, price };
  alert(`${type} ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá`);
}

function goToCheckout() {
  if (!selectedPkg) return pkgError.textContent = "‚ö†Ô∏è ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®";
  selectedInfo.innerHTML = `
    <p>üì¶ ${selectedPkg.type}</p>
    <p>üïí ${selectedPkg.duration}</p>
    <p>üí∞ ${selectedPkg.price} TK</p>`;
  showPage('checkoutPage');
}

function updatePaymentNumber() {
  const m = paymentMethod.value;
  let num = "";
  if (m === "Bkash") num = "01740433733";
  if (m === "Nagad" || m === "Rocket") num = "01603599843";
  payNumber.innerHTML = num ? `${m} ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞: <b>${num}</b> <button onclick="navigator.clipboard.writeText('${num}')">üìã ‡¶ï‡¶™‡¶ø</button>` : "";
}

async function confirmOrder() {
  const name = coName.value.trim();
  const email = coEmail.value.trim();
  const addr = coAddress.value.trim();
  const mobile = coMobile.value.trim();
  const trans = coTransID.value.trim();
  const pm = paymentMethod.value;
  coError.textContent = "";
  if (!name || !email || !addr || !mobile || !trans || !pm) return coError.textContent = "‚ö†Ô∏è ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®";

  const data = {
    ...selectedPkg,
    name, email, addr, mobile, trans, pm,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  };
  try {
    await db.collection('orders').add(data);
    await emailjs.send(emailService, custTpl, data);
    await emailjs.send(emailService, adminTpl, data);
    alert("‚úÖ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤! ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
    showPage('mainPage');
  } catch (err) {
    alert("‚ùå ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: " + err.message);
  }
}
</script>
</body>
</html>
