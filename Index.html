<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Crunchyroll Premium BD Shop</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <style>
    body {margin:0;font-family:'Segoe UI',sans-serif;background:#131c2b;color:white;}
    .page {display:none;padding:20px;max-width:600px;margin:auto;}
    .active {display:block;}
    img.banner {width:100%;border-radius:8px;}
    img.avatar {width:100px;height:100px;border-radius:50%;border:3px solid white;display:block;margin:20px auto;}
    input, select, button {width:100%;padding:10px;margin:8px 0;border-radius:6px;border:none;font-size:16px;}
    button {cursor:pointer;}
    .mega-btn {background:green;color:white;}
    .package-btn {background:#0f7dc8;color:white;margin-top:6px;border-radius:8px;}
    .package-btn:hover {background:#095e9f;}
    .action-btns {display:flex;justify-content:space-between;margin-top:16px;}
    .orange {background:orange;color:black;}
    .green {background:green;color:white;}
    .error {color:#ff4d4d;}
    .copy-box {background:#2d3a4a;padding:10px;border-radius:8px;margin-top:10px;}
  </style>
</head>
<body>

<!-- Sign Up -->
<div id="signupPage" class="page active">
  <h2>ЁЯФР рж╕рж╛ржЗржи ржЖржк</h2>
  <input id="suEmail" type="email" placeholder="ЁЯУз ржЗржорзЗржЗрж▓">
  <input id="suPhone" type="text" placeholder="ЁЯУ▒ ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░">
  <input id="suPass" type="password" placeholder="ЁЯФС ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб (рзм рж╕ржВржЦрзНржпрж╛рж░)">
  <input id="suConfirm" type="password" placeholder="ЁЯФС ржХржиржлрж╛рж░рзНржо ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб">
  <input id="suCity" type="text" placeholder="ЁЯПЩя╕П рж╢рж╣рж░">
  <button onclick="handleSignup()">тЬЕ рж╕рж╛ржЗржи ржЖржк</button>
  <p>ржЗрждрж┐ржоржзрзНржпрзЗ ржПржХрж╛ржЙржирзНржЯ ржЖржЫрзЗ? <a href="#" onclick="showPage('loginPage')">рж╕рж╛ржЗржи ржЗржи ржХрж░рзБржи</a></p>
  <p id="suError" class="error"></p>
</div>

<!-- Sign In -->
<div id="loginPage" class="page">
  <h2>ЁЯФУ рж╕рж╛ржЗржи ржЗржи</h2>
  <input id="liEmail" type="email" placeholder="ЁЯУз ржЗржорзЗржЗрж▓">
  <input id="liPass" type="password" placeholder="ЁЯФС ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб">
  <button onclick="handleLogin()">тЮбя╕П рж╕рж╛ржЗржи ржЗржи ржХрж░рзБржи</button>
  <p>ржирждрзБржи? <a href="#" onclick="showPage('signupPage')">рж╕рж╛ржЗржи ржЖржк ржХрж░рзБржи</a></p>
  <p id="liError" class="error"></p>
</div>

<!-- Main Page -->
<div id="mainPage" class="page">
  <img src="https://i.postimg.cc/KvBrVgmR/20250625-061716.jpg" class="banner">
  <img src="https://i.postimg.cc/PxJQF3qj/89fcdebedfdcf2bf3a00a49d75833c3a-1.jpg" class="avatar">
  <h2 style="text-align:center;">Welcome to Crunchyroll Premium BD Shop</h2>
  <button class="mega-btn" onclick="showPage('packagePage')">ЁЯТе MEGA PACKAGES</button>
  <p style="margin-top:20px;"><strong>Total Users:</strong> <span id="userCount">0</span> |
     <strong>Total Orders:</strong> <span id="orderCount">0</span></p>
</div>

<!-- Package Page -->
<div id="packagePage" class="page">
  <h2>ЁЯУж ржкрзНржпрж╛ржХрзЗржЬ рж╕рж┐рж▓рзЗржХрж╢ржи</h2>
  <!-- Shared -->
  <h3>ЁЯУд Shared Profile</h3>
  <button class="package-btn" onclick="selectPackage('Shared Profile','1 Month',100)">1 Month тАУ 100 TK</button>
  <button class="package-btn" onclick="selectPackage('Shared Profile','2 Months',200)">2 Months тАУ 200 TK</button>
  <button class="package-btn" onclick="selectPackage('Shared Profile','3 Months',300)">3 Months тАУ 300 TK</button>
  <button class="package-btn" onclick="selectPackage('Shared Profile','6 Months',600)">6 Months тАУ 600 TK</button>
  <button class="package-btn" onclick="selectPackage('Shared Profile','8 Months',840)">8 Months тАУ 840 TK</button>
  <!-- Personal -->
  <h3>ЁЯСд Personal Profile</h3>
  <button class="package-btn" onclick="selectPackage('Personal Profile','1 Month',240)">1 Month тАУ 240 TK</button>
  <button class="package-btn" onclick="selectPackage('Personal Profile','2 Months',480)">2 Months тАУ 480 TK</button>
  <button class="package-btn" onclick="selectPackage('Personal Profile','3 Months',720)">3 Months тАУ 720 TK</button>
  <button class="package-btn" onclick="selectPackage('Personal Profile','6 Months',1440)">6 Months тАУ 1440 TK</button>
  <button class="package-btn" onclick="selectPackage('Personal Profile','8 Months',1800)">8 Months тАУ 1800 TK</button>
  <button class="package-btn" onclick="selectPackage('Personal Profile','12 Months',2760)">12 Months тАУ 2760 TK</button>
  <!-- Primary -->
  <h3>ЁЯСС Primary Account</h3>
  <button class="package-btn" onclick="selectPackage('Primary Account','1 Month',650)">1 Month тАУ 650 TK</button>
  <button class="package-btn" onclick="selectPackage('Primary Account','2 Months',1300)">2 Months тАУ 1300 TK</button>
  <button class="package-btn" onclick="selectPackage('Primary Account','3 Months',1950)">3 Months тАУ 1950 TK</button>
  <button class="package-btn" onclick="selectPackage('Primary Account','6 Months',3600)">6 Months тАУ 3600 TK</button>

  <div class="action-btns">
    <button class="orange" onclick="showPage('checkoutPage')">ЁЯЫТ Add To Cart</button>
    <button class="green" onclick="showPage('mainPage')">тмЕя╕П Back To Home</button>
  </div>
  <p id="pkgError" class="error"></p>
</div>

<!-- Checkout Page -->
<div id="checkoutPage" class="page">
  <h2>тЬЕ Checkout</h2>
  <div id="selectedInfo"></div>
  <div style="margin-top:20px;">
    <input id="coName" type="text" placeholder="Full Name">
    <input id="coEmail" type="email" placeholder="Email">
    <input id="coAddress" type="text" placeholder="Street Address">
    <input id="coMobile" type="text" placeholder="Mobile Number">
    <input id="coPaymentNumber" type="text" placeholder="Payment Number">
    <input id="coTransID" type="text" placeholder="Transaction ID">
    <select id="paymentMethod" onchange="updatePayNumber()">
      <option value="">-- ржкрзЗржорзЗржирзНржЯ ржорзЗржержб рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзБржи --</option>
      <option value="Bkash">Bkash</option>
      <option value="Nagad">Nagad</option>
      <option value="Rocket">Rocket</option>
    </select>
    <div id="payNumber" class="copy-box"></div>
    <p>ржЕржмрж╢рзНржпржЗ рж╕рзЗржирзНржб ржорж╛ржирж┐ ржХрж░рждрзЗ рж╣ржмрзЗ ржПржмржВ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржкрж░рж┐ржорж╛ржг ржкрж╛ржарж╛ржмрзЗржиред ржХржо ржкрж╛ржарж╛рж▓рзЗ рж░рж┐ржлрж╛ржирзНржб рж╣ржмрзЗ ржирж╛ред</p>
    <button class="green" onclick="confirmOrder()">тЬЕ Order Confirm</button>
    <button class="orange" onclick="showPage('packagePage')">тмЕя╕П Back To Packages</button>
  </div>
  <p id="coError" class="error"></p>
</div>

<script>
// --- Configurations ---
const firebaseConfig = {
  apiKey: "AIzaSyDDvKtm-Mu_12pDLo_9bPvLOusx6YyoYI4", authDomain: "crunchyrollpremiumbd-shop.firebaseapp.com", projectId: "crunchyrollpremiumbd-shop",
};
const emailjsConfig = {
  service: "service_z1714kq",
  adminTpl: "template_hp66tqp",
  custTpl: "template_1z1lhlf",
  publicKey: "SsUmUorUm-BZG8LBY"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
emailjs.init(emailjsConfig.publicKey);

// --- Helpers ---
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function validPhone(p){ return /^\d{11}$/.test(p) }
function validPass(p){ return /^\d{6}$/.test(p) }

// --- SignUp ---
async function handleSignup(){
  const e = document.getElementById('suEmail').value.trim();
  const p = document.getElementById('suPhone').value.trim();
  const pw = document.getElementById('suPass').value;
  const cp = document.getElementById('suConfirm').value;
  const c = document.getElementById('suCity').value.trim();
  const err = document.getElementById('suError'); err.textContent="";
  if (!validPhone(p)){err.textContent="тЪая╕П ржорзЛржмрж╛ржЗрж▓ рззрзз рж╕ржВржЦрзНржпрж╛рж░ рж╣рждрзЗ рж╣ржмрзЗ"; return;}
  if (!validPass(pw)){err.textContent="тЪая╕П ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рзм рж╕ржВржЦрзНржпрж╛рж░ рж╕ржВржЦрзНржпрж╛ рж╣рждрзЗ рж╣ржмрзЗ"; return;}
  if (pw!==cp){err.textContent="тЪая╕П ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржорж┐рж▓ржЫрзЗ ржирж╛";return;}
  if (!c){err.textContent="тЪая╕П рж╢рж╣рж░ рж▓рж┐ржЦрзБржи";return;}
  try {
    const snap1 = await db.collection('users').where('email','==',e).get();
    if (!snap1.empty){err.textContent="тЪая╕П ржкрзВрж░рзНржмрзЗ рж╕рж╛ржЗржи ржЖржк ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ";return;}
    const snap2 = await db.collection('users').where('phone','==',p).get();
    if (!snap2.empty){err.textContent="тЪая╕П ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░ ржЖржЧрзЗржЗ ржмрзНржпржмрж╣рзГржд рж╣рзЯрзЗржЫрзЗ";return;}
    await auth.createUserWithEmailAndPassword(e, pw);
    await auth.currentUser.sendEmailVerification();
    await db.collection('users').add({email:e,phone:p,city:c,timestamp:firebase.firestore.FieldValue.serverTimestamp()});
    alert("тЬЕ рж╕рж╛ржЗржи ржЖржк рж╕ржлрж▓! ржЗржорзЗржЗрж▓рзЗ ржнрзЗрж░рж┐ржлрж┐ржХрзЗрж╢ржи ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝рзЗржЫрзЗред");
    showPage('loginPage');
  } catch(err){err.textContent = err.message;}
}

// --- Login ---
async function handleLogin(){
  const e = document.getElementById('liEmail').value.trim();
  const pw = document.getElementById('liPass').value;
  const err = document.getElementById('liError'); err.textContent="";
  try{
    const res = await auth.signInWithEmailAndPassword(e, pw);
    if (!res.user.emailVerified){
      err.textContent = "тЪая╕П ржЗржорзЗржЗрж▓ ржнрзЗрж░рж┐ржлрж╛ржЗ ржХрж░рзБржи";
      return;
    }
    alert("тЬЕ рж▓ржЧржЗржи рж╕ржлрж▓ рж╣ржпрж╝рзЗржЫрзЗ");
    showPage('mainPage');
    startListeners();
  } catch(error){
    if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
      err.textContent = "тЭМ ржЗржорзЗржЗрж▓ ржмрж╛ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржнрзБрж▓";
    } else {
      err.textContent = error.message;
    }
  }
}

// --- Counts ---
function startListeners(){
  db.collection('users').onSnapshot(s=>document.getElementById('userCount').textContent = s.size);
  db.collection('orders').onSnapshot(s=>document.getElementById('orderCount').textContent = s.size);
}

// --- Package Selection ---
let selectedPkg = null;
function selectPackage(profile,duration,price){
  selectedPkg = {profile,duration,price};
  document.getElementById('pkgError').textContent = "";
  alert(`тЬЕ '${profile}' (${duration}) тАУ ${price} TK рж╕рж┐рж▓рзЗржХрзНржЯ рж╣рзЯрзЗржЫрзЗ`);
}

// --- Update Payment Number ---
function updatePayNumber(){
  const m = document.getElementById('paymentMethod').value;
  let num="";
  if (m==="Bkash") num="01740433733";
  if (m==="Nagad"||m==="Rocket") num="01603599843";
  document.getElementById('payNumber').innerHTML = num ?
    `${m} ржиржорзНржмрж░: <strong>${num}</strong> <button onclick="navigator.clipboard.writeText('${num}')">ЁЯУЛ ржХржкрж┐</button>` : "";
}

// --- Show Checkout Info ---
function goToCheckout(){
  if (!selectedPkg){ document.getElementById('pkgError').textContent="тЪая╕П ржкрзНржпрж╛ржХрзЗржЬ рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзБржи"; return; }
  document.getElementById('selectedInfo').innerHTML =
    `<p>ЁЯУж ржЖржкржирж┐ ржирж┐рзЯрзЗржЫрзЗржи: <strong>${selectedPkg.profile}</strong></p>
     <p>ЁЯХТ ржорзЗрзЯрж╛ржж: <strong>${selectedPkg.duration}</strong></p>
     <p>ЁЯТ░ ржорзВрж▓рзНржп: <strong>${selectedPkg.price} TK</strong></p>`;
  showPage('checkoutPage');
}

// --- Confirm Order ---
async function confirmOrder(){
  const name = document.getElementById('coName').value.trim();
  const email = document.getElementById('coEmail').value.trim();
  const addr = document.getElementById('coAddress').value.trim();
  const mobile = document.getElementById('coMobile').value.trim();
  const payNo = document.getElementById('coPaymentNumber').value.trim();
  const trans = document.getElementById('coTransID').value.trim();
  const pm = document.getElementById('paymentMethod').value;
  const coErr = document.getElementById('coError'); coErr.textContent="";
  if (!name||!email||!addr||!mobile||!payNo||!trans||!pm){coErr.textContent="тЪая╕П рж╕ржм рждржерзНржп ржнрж░рзБржи"; return;}
  try {
    const data = {...selectedPkg,name,email,addr,mobile,payNo,trans,pm, timestamp: firebase.firestore.FieldValue.serverTimestamp()};
    await db.collection('orders').add(data);
    // Emails
    emailjs.send(emailjsConfig.service, emailjsConfig.custTpl, data);
    emailjs.send(emailjsConfig.service, emailjsConfig.adminTpl, data);
    alert("тЬЕ ржЕрж░рзНржбрж╛рж░ рж╕ржлрж▓ рж╣рзЯрзЗржЫрзЗред ржХрж╛рж╕рзНржЯржорж╛рж░ ржУ ржЕрзНржпрж╛ржбржорж┐ржирзЗ ржЗржорзЗржЗрж▓ ржкрж╛ржарж╛ржирзЛ рж╣рзЯрзЗржЫрзЗред");
    showPage('mainPage');
  } catch(err){
    alert("тЭМ ржЕрж░рзНржбрж╛рж░ ржмрзНржпрж░рзНрже: "+err.message);
  }
}

// handle Add to Cart button
document.querySelector('#packagePage .orange').addEventListener('click', function(){
  goToCheckout();
});
</script>

</body>
</html>
