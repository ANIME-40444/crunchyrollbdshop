<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Crunchyroll Premium BD Shop</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <style>
    body {margin:0;font-family:'Segoe UI',sans-serif;background:#131c2b;color:white;}
    .page {display:none;padding:20px;max-width:600px;margin:auto;}
    .active {display:block;}
    .top-bar {text-align:right;padding:10px;font-size:16px;color:orange;}
    input, button {width:100%;padding:10px;margin:6px 0;border-radius:6px;border:none;font-size:16px;}
    button {cursor:pointer;background:green;color:white;}
    .error {color:#ff4d4d;}
  </style>
</head>
<body>
<div id="topBar" class="top-bar"></div>
<div id="signupPage" class="page active">
  <h2>üîê ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™</h2>
  <input id="suName" type="text" placeholder="üë§ Full Name">
  <input id="suEmail" type="email" placeholder="üìß ‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
  <input id="suPhone" type="text" placeholder="üì± ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
  <input id="suPass" type="password" placeholder="üîë ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° (‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞)">
  <input id="suConfirm" type="password" placeholder="üîë ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
  <button onclick="handleSignup()">‚úÖ ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™</button>
  <p>‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá? <a href="#" onclick="showPage('loginPage')">‡¶∏‡¶æ‡¶á‡¶® ‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
  <p id="suError" class="error"></p>
</div>
<div id="loginPage" class="page">
  <h2>üîì ‡¶∏‡¶æ‡¶á‡¶® ‡¶á‡¶®</h2>
  <input id="liEmail" type="email" placeholder="üìß ‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
  <input id="liPass" type="password" placeholder="üîë ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
  <button onclick="handleLogin()">‚û°Ô∏è ‡¶∏‡¶æ‡¶á‡¶® ‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
  <p>‡¶®‡¶§‡ßÅ‡¶®? <a href="#" onclick="showPage('signupPage')">‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
  <p id="liError" class="error"></p>
</div>
<script>
const config = {
  apiKey: "AIzaSyDDvKtm-Mu_12pDLo_9bPvLOusx6YyoYI4",
  authDomain: "crunchyrollpremiumbd-shop.firebaseapp.com",
  projectId: "crunchyrollpremiumbd-shop",
};
firebase.initializeApp(config);
const auth = firebase.auth();
const db = firebase.firestore();

function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function validPhone(p){ return /^\d{11}$/.test(p) }
function validPass(p){ return /^\d{6}$/.test(p) }

async function handleSignup(){
  const n = document.getElementById('suName').value.trim();
  const e = document.getElementById('suEmail').value.trim();
  const p = document.getElementById('suPhone').value.trim();
  const pw = document.getElementById('suPass').value;
  const cp = document.getElementById('suConfirm').value;
  const err = document.getElementById('suError'); err.textContent="";
  if (!n){err.textContent="‚ö†Ô∏è ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®";return;}
  if (!validPhone(p)){err.textContent="‚ö†Ô∏è ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡ßß‡ßß ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá"; return;}
  if (!validPass(pw)){err.textContent="‚ö†Ô∏è ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá"; return;}
  if (pw!==cp){err.textContent="‚ö†Ô∏è ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ";return;}
  try {
    const snap1 = await db.collection('users').where('email','==',e).get();
    if (!snap1.empty){err.textContent="‚ö†Ô∏è ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá";return;}
    await auth.createUserWithEmailAndPassword(e, pw);
    await auth.currentUser.sendEmailVerification();
    await db.collection('users').add({name:n,email:e,phone:p,timestamp:firebase.firestore.FieldValue.serverTimestamp()});
    alert("‚úÖ ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶∏‡¶´‡¶≤! ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
    showPage('loginPage');
  } catch(error){err.textContent = error.message;}
}

async function handleLogin(){
  const e = document.getElementById('liEmail').value.trim();
  const pw = document.getElementById('liPass').value;
  const err = document.getElementById('liError'); err.textContent="";
  try{
    const res = await auth.signInWithEmailAndPassword(e, pw);
    if (!res.user.emailVerified){throw new Error();}
    const snap = await db.collection('users').where('email','==',e).get();
    const name = snap.empty ? "User" : snap.docs[0].data().name;
    document.getElementById('topBar').innerHTML = `üë§ Welcome, <strong>${name}</strong>`;
    showPage('mainPage');
  } catch{err.textContent = "‚ö†Ô∏è ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤ ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶ñ‡¶®‡ßã ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø";}
}
</script>
</body>
</html>
