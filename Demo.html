<!DOCTYPE html><html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crunchyroll Premium BD</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; background: #fff; color: #000; }
    .container { max-width: 1200px; margin: auto; padding: 20px; }
    .banner, .avatar { width: 100%; border-radius: 8px; margin-bottom: 20px; }
    .section { margin-bottom: 40px; }
    .package-btn, .btn, button { padding: 10px 20px; font-size: 16px; border-radius: 8px; border: none; cursor: pointer; }
    .buy-now-btn { background: #007bff; color: #fff; display: block; margin: 20px auto; }
    .green { background: green; color: #fff; }
    .orange { background: orange; color: #000; }
    .input, input, select { width: 100%; padding: 10px; margin-top: 10px; border-radius: 6px; border: 1px solid #ccc; }
    .hidden { display: none; }
    .page { display: none; }
    .active { display: block; }
    .top-right { position: fixed; top: 10px; right: 20px; font-size: 24px; cursor: pointer; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
</head>
<body>
<div class="container">
  <div class="top-right" onclick="showPage('reviewPage')">‚ãÆ</div>  <!-- Main Page -->  <div id="mainPage" class="page active">
    <img src="https://i.postimg.cc/KvBrVgmR/20250625-061716.jpg" class="banner" />
    <img src="https://i.postimg.cc/PxJQF3qj/89fcdebedfdcf2bf3a00a49d75833c3a-1.jpg" class="avatar" />
    <h2 id="descriptionText">Loading Description...</h2>
    <button class="buy-now-btn" onclick="showPage('packagePage')">BUY NOW</button>
    <p style="text-align:center;">
      <strong>Total Users:</strong> <span id="userCount">0</span> |
      <strong>Total Orders:</strong> <span id="orderCount">0</span>
    </p>
  </div>  <!-- Package Page -->  <div id="packagePage" class="page">
    <h2>üì¶ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡¶∂‡¶®</h2>
    <div id="packagesContainer">Loading Packages...</div>
    <div>
      <button class="orange" onclick="goToCheckout()">üõí Add to Cart</button>
      <button class="green" onclick="showPage('mainPage')">‚¨ÖÔ∏è Back</button>
    </div>
  </div>  <!-- Checkout Page -->  <div id="checkoutPage" class="page">
    <h2>Checkout</h2>
    <div id="selectedPackageInfo"></div>
    <input id="coName" type="text" placeholder="Full Name" />
    <input id="coEmail" type="email" placeholder="Email" />
    <input id="coAddress" type="text" placeholder="Address" />
    <input id="coMobile" type="text" placeholder="Mobile Number" />
    <input id="coPaymentNumber" type="text" placeholder="Payment Number" />
    <input id="coTransID" type="text" placeholder="Transaction ID" />
    <select id="paymentMethod">
      <option value="">Select Payment Method</option>
      <option value="Bkash">Bkash</option>
      <option value="Nagad">Nagad</option>
      <option value="Rocket">Rocket</option>
    </select>
    <button class="green" onclick="confirmOrder()">Confirm Order</button>
    <button class="orange" onclick="showPage('packagePage')">‚¨ÖÔ∏è Back</button>
    <p id="checkoutError" style="color:red;"></p>
  </div>  <!-- Order Tracking Page -->  <div id="reviewPage" class="page">
    <h2>üìù ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â/‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç</h2>
    <div id="userOrders">Loading...</div>
    <button class="orange" onclick="showPage('mainPage')">‚¨ÖÔ∏è Back</button>
  </div>
</div><script>
  const firebaseConfig = {
    apiKey: 'AIzaSyDDvKtm-Mu_12pDLo_9bPvLOusx6YyoYI4',
    authDomain: 'crunchyrollpremiumbd-shop.firebaseapp.com',
    projectId: 'crunchyrollpremiumbd-shop'
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const emailjsConfig = {
    service: 'service_z1714kq',
    adminTpl: 'template_hp66tqp',
    custTpl: 'template_1z1lhlf',
    publicKey: 'SsUmUorUm-BZG8LBY'
  };
  emailjs.init(emailjsConfig.publicKey);

  function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if (id === 'reviewPage') loadOrders();
  }

  let selectedPackage = null;
  function goToCheckout() {
    if (!selectedPackage) return alert('‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®');
    document.getElementById('selectedPackageInfo').innerText = `${selectedPackage.name} ‚Äì ${selectedPackage.duration} (${selectedPackage.price} TK)`;
    showPage('checkoutPage');
  }

  async function confirmOrder() {
    const name = document.getElementById('coName').value.trim();
    const email = document.getElementById('coEmail').value.trim();
    const addr = document.getElementById('coAddress').value.trim();
    const mobile = document.getElementById('coMobile').value.trim();
    const payNo = document.getElementById('coPaymentNumber').value.trim();
    const trans = document.getElementById('coTransID').value.trim();
    const pm = document.getElementById('paymentMethod').value;
    const err = document.getElementById('checkoutError');

    if (!name || !email || !addr || !mobile || !payNo || !trans || !pm) {
      err.textContent = '‚ö†Ô∏è ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®'; return;
    }
    const data = {
      ...selectedPackage, name, email, addr, mobile, payNo, trans, pm,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    };
    await db.collection('orders').add(data);
    emailjs.send(emailjsConfig.service, emailjsConfig.custTpl, data);
    emailjs.send(emailjsConfig.service, emailjsConfig.adminTpl, data);
    alert('‚úÖ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
    showPage('mainPage');
  }

  function loadOrders() {
    const userEmail = prompt('‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶®:');
    db.collection('orders').where('email', '==', userEmail).get().then(snap => {
      if (snap.empty) return document.getElementById('userOrders').innerText = '‡¶ï‡ßã‡¶® ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡ßá‡¶á';
      let html = '<ul>';
      snap.forEach(doc => {
        const d = doc.data();
        html += `<li>${d.name} | ${d.profile} | ${d.duration} | ${d.trans}</li>`;
      });
      html += '</ul>';
      document.getElementById('userOrders').innerHTML = html;
    });
  }

  async function loadDescriptionAndPackages() {
    const dSnap = await db.collection('website').doc('main').get();
    document.getElementById('descriptionText').innerText = dSnap.exists ? dSnap.data().description : 'Welcome!';

    const pSnap = await db.collection('packages').get();
    const container = document.getElementById('packagesContainer');
    container.innerHTML = '';
    pSnap.forEach(doc => {
      const d = doc.data();
      const btn = document.createElement('button');
      btn.className = 'package-btn';
      btn.innerText = `${d.name} ‚Äì ${d.duration} (${d.price} TK)`;
      btn.onclick = () => { selectedPackage = d; alert('‚úÖ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'); };
      container.appendChild(btn);
    });
  }

  db.collection('users').onSnapshot(snap => {
    document.getElementById('userCount').textContent = snap.size;
  });
  db.collection('orders').onSnapshot(snap => {
    document.getElementById('orderCount').textContent = snap.size;
  });

  window.onload = loadDescriptionAndPackages;
</script></body>
</html>
